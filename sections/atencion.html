<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QF PRO ‚Äî Atenci√≥n farmac√©utica</title>
  <!-- Tu hoja de estilos global -->
  <link rel="stylesheet" href="../css/styles.css"/>
  <style>
        /* ======= ESTILOS PRINCIPALES ======= */
    /* ===== Ajustes m√≠nimos locales: no pisan tu styles.css ===== */
    .tabs-row{display:flex;margin-left:8px;gap:10px;flex-wrap:wrap;margin:10px 0 8px}
    .tab-btn{border:1px solid rgba(148,163,184,.18);background:transparent;color:#d1d5db;border-radius:999px;padding:6px 10px;cursor:pointer}
    .tab-btn.active{background:#0c172c;border-color:rgba(148,163,184,.35)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:center}
    .grid3{display:grid;grid-template-columns:1fr 280px;gap:24px;align-items:flex-start}
    .card{background:#0c172c;border:1px solid rgba(148,163,184,.18);border-radius:12px;padding:12px}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .col{display:flex;flex-direction:column}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#0b74d1;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px}
    .chip.warn{background:#ff9800;color:#111}
    .btn-lg{display:block;width:100%;padding:10px 14px;border:1px solid rgba(148,163,184,.3);border-radius:8px;background:#101c33;color:#e5e7eb;text-align:center;transition:background .2s}
    .btn-lg:hover{background:#15274a}
    .btn.mini{padding:4px 8px;font-size:12px}
    .muted{color:#8a8b9a}
    .seg-title{font-weight:700;margin-bottom:6px}
    .fichas-panel{border-left:1px solid rgba(148,163,184,0.2);padding-left:16px}
    .fichas-lista{display:flex;flex-direction:column;gap:10px}
    .ficha-card{background:#101c33;border:1px solid rgba(148,163,184,.3);border-radius:8px;padding:10px 12px}
    .ficha-card.active{border-color:#0b74d1;box-shadow:0 0 0 1px rgba(11,116,209,.3)}
    .trash{cursor:pointer;opacity:0.8}
    #header-paciente{font-weight:600;margin:6px 0 4px 0}
    [data-panel]{display:none}
        .sexo-f{color:#f472b6;font-weight:700}
    .sexo-m{color:#60a5fa;font-weight:700}
    .pill{background:#0f213a;border:1px solid rgba(148,163,184,.18);padding:2px 8px;border-radius:999px}
    .list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px}
    .list li{background:#0f172a;border:1px solid rgba(148,163,184,.18);border-radius:10px;padding:8px}
    .row-end{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
    .recipe{margin-top:8px;padding:10px;border:1px dashed rgba(148,163,184,.25);border-radius:12px}
    .med-block{display:flex;flex-direction:column;gap:18px;margin-top:8px}
    .med-sub{display:flex;flex-direction:column;gap:8px}
    .med-sub[data-visible="entrevista"]{display:none}
    .med-subtitle{font-size:15px;font-weight:600;color:#e2e8f0;margin:0}
    .searchbox{position:relative}
    .searchbox input{width:100%}
    .sugg{display:none;position:absolute;left:0;right:0;top:100%;background:#0f172a;border:1px solid rgba(148,163,184,.18);border-radius:12px;padding:6px;max-height:240px;overflow:auto;z-index:20}
    .sugg div{padding:6px 8px;border-radius:8px;cursor:pointer}
    .sugg div:hover{background:#1e293b}
    .sugg div.picked{outline:2px solid #4663ff;background:#0b224a}
    .qty-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
    .muted-card{background:#0f172a;border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:10px;color:#94a3b8}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,.76);z-index:1000;justify-content:center;align-items:center;padding:16px}
    .modal .modal-card{background:#0f172a;border:1px solid rgba(148,163,184,.35);border-radius:16px;padding:20px;width:100%;max-width:720px;max-height:90vh;overflow:auto}
  </style>
</head>
<body>
<div class="app">
  <!-- ======== SIDEBAR (se mantiene tu navegaci√≥n) ======== -->
  <aside class="sidebar">
    <div class="brand"><strong>QF PRO</strong><br><span class="muted">Atenci√≥n</span></div>
    <nav style="margin-top:12px">
      <a class="nav-item" href="../index.html">üè∑Ô∏è Inicio</a>
      <a class="nav-item active" href="atencion.html">üßë‚Äç‚öïÔ∏è Atenci√≥n farmac√©utica</a>
      <a class="nav-item" href="generador.html">üìù Generador de texto</a>
      <a class="nav-item" href="vademecum.html">üíä Vadem√©cum</a>
      <a class="nav-item" href="material.html">üìö Material de consulta</a>
      <a class="nav-item" href="herramientas.html">üß∞ Herramientas</a>
      <a class="nav-item" href="proa.html">üß™ PROA</a>
      <a class="nav-item" href="plantas.html">üåø Plantas medicinales</a>
      <a class="nav-item" href="protocolos.html">üìë Orientaciones t√©cnicas</a>
      <a class="nav-item" href="config.html">‚öôÔ∏è Configuraci√≥n</a>
    </nav>
  </aside>

  <!-- ======== MAIN ======== -->
  <main class="main">
    <!-- Header global montado por header.js -->
    <div id="header" data-show-autosave="1"></div>

    <!-- T√≠tulo din√°mico de ficha activa (iniciales ¬∑ sexo ¬∑ edad) -->
    <div id="header-paciente" style="display:none;margin-left:8px;"></div>

    <!-- ===== NAV TABS (controladas por tipo de atenci√≥n) ===== -->
    <div class="tabs-row" id="tabs">
      <button class="tab-btn active" data-tab="ficha">CREAR FICHA</button>
      <button class="tab-btn" data-tab="ante">ANTECEDENTES</button>
      <button class="tab-btn" data-tab="anam">ANAMNESIS</button>
      <button class="tab-btn" data-tab="meds">MEDICAMENTOS</button>
      <button class="tab-btn" data-tab="ea">Reacciones adversas</button>
      <button class="tab-btn" data-tab="prm">PRM</button>
      <button class="tab-btn" data-tab="edu">EDUCACI√ìN</button>
      <button class="tab-btn" data-tab="herr">HERRAMIENTAS</button>
      <button class="tab-btn" data-tab="indi">INDICACIONES</button>
      <button class="tab-btn" data-tab="acu">ACUERDOS</button>
    </div>

    <!-- ===== CONTENIDO PRINCIPAL + PANEL LATERAL ===== -->
    <div class="grid3">
      <section class="content col" style="gap:12px">

        <!-- ====== PANEL CREAR FICHA ====== -->
        <div id="panel-ficha" data-panel class="card" style="display:block">
          <div class="seg-title">CREAR FICHA</div>

          <div class="grid2" style="margin-top:10px;">
            <!-- Imagen izquierda -->
            <div style="text-align:center;">
              <img src="../img/ficha.png" alt="Creaci√≥n de ficha" style="width:260px;max-width:90%;height:auto;"/>
            </div>
            <!-- Formulario derecha -->
            <div>
              <div class="row" style="margin-bottom:8px;">
                <label>Iniciales:
                  <input id="ini" maxlength="3" placeholder="ABC" style="width:90px; text-transform:uppercase;" title="Ingresa 3 letras en may√∫sculas"/>
                </label>
<label>‚â•65:
  <input id="mayor65" type="checkbox"/>
</label>

                <label>Sexo:
                  <select id="sexo">
                    <option value="">‚Äî</option>
                    <option value="F">‚ôÄ F</option>
                    <option value="M">‚ôÇ M</option>
                  </select>
                </label>
                <button id="btn-crear" class="btn">CREAR</button>
              </div>

              <!-- Chips -->
              <div class="row" id="chips-area" style="margin-top:4px;">
                <span id="chip-65" class="chip" style="display:none;">‚â•65 (PPI)</span>
                <span id="chip-emb" class="chip warn" style="display:none;">Seguridad en embarazo</span>
              </div>

              <!-- Tipos de atenci√≥n -->
              <div class="col" style="gap:8px;margin-top:12px;">
                <button class="btn-lg" id="tipo-sinconc">SIN ENTREVISTA: CONCILIACI√ìN</button>
                <button class="btn-lg" id="tipo-sinram">SIN ENTREVISTA: RAM</button>
                <button class="btn-lg" id="tipo-conreg">CON ENTREVISTA: REGULAR</button>
                <button class="btn-lg" id="tipo-conmais">CON ENTREVISTA: AMPLIADA</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ====== PANELS DE CONTENIDO ====== -->
        <div id="panel-ante" data-panel class="card">
          <div class="seg-title">ANTECEDENTES</div>
          <div class="row">
            <input id="ant-input" list="ant-suggest" placeholder="Escribe un antecedente y presiona Enter‚Ä¶"/>
            <datalist id="ant-suggest"></datalist>
            <div id="ant-list" class="row" style="gap:6px"></div>
          </div>
          <div class="row" style="gap:12px;margin-top:8px">
            <label class="pick mini"><input type="checkbox" id="ant-iamacv"> ANT IAM/ACV</label>
            <label class="pick mini"><input type="checkbox" id="ant-erc"> ERC</label>
            <label class="pick mini" id="wrap-embarazo" style="display:none"><input type="checkbox" id="ant-embarazo"> Embarazo</label>
          </div>
        </div>

        <div id="panel-anam" data-panel class="card">
          <div class="seg-title">ANAMNESIS</div>
          <div class="muted">Completar motivo de consulta, s√≠ntomas, escalas aplicadas, etc.</div>
        </div>

        <div id="panel-meds" data-panel class="card">
          <div class="seg-title">MEDICAMENTOS</div>
                    <p class="muted">Gestiona recetas APS/secundario y reg√≠stralas en distintos niveles. Usa la importaci√≥n para copiar directamente desde Rayen.</p>

          <!-- ======= PLANTILLAS DE CONTROLES ======= -->
          <template id="sku-controls-tpl">
            <div class="qty-row">
              <div class="seg-qty"></div>
              <select class="seg-pos" style="min-width:160px">
                <option>CADA 24 HORAS</option>
                <option>CADA 12 HORAS</option>
                <option>CADA 8 HORAS</option>
                <option>SOS</option>
              </select>
              <button class="btn seg-add" disabled>Agregar</button>
            </div>
          </template>

          <template id="searchbox-tpl">
            <div class="searchbox">
              <input class="seg-search" placeholder="Escribe al menos 2 letras para buscar‚Ä¶"/>
              <div class="sugg seg-sugg"></div>
            </div>
          </template>

          <template id="recipe-tpl">
            <div class="recipe">
              <div class="row" style="gap:10px;flex-wrap:wrap;align-items:center">
                <label>Fecha receta: <input type="date" class="rec-fecha"/></label>
                <label>Duraci√≥n (meses): <input type="number" min="1" step="1" value="3" class="rec-meses" style="width:90px"/></label>
                <button class="btn mini rec-del">Eliminar receta</button>
              </div>
              <div class="seg-box" style="margin-top:8px"></div>
              <ul class="list seg-list" style="margin-top:8px"></ul>
            </div>
          </template>

            <!-- ======= MEDICACI√ìN ======= -->
          <h3>1Ô∏è‚É£ Medicaci√≥n</h3>
          <div class="med-block">
            <section class="med-sub" id="med-aps">
              <h4 class="med-subtitle">APS</h4>
              <div id="aps-recetas" class="recipe-host recipe-aps"></div>
              <div class="row-end" style="margin-top:8px">
                <button id="aps-add-rec" class="btn">Agregar receta APS</button>
                <button id="btn-import-rayen" class="btn">Importar receta</button>
              </div>
            </section>

            <section class="med-sub" id="med-sec">
              <h4 class="med-subtitle">A2S</h4>
              <div id="sec-recetas" class="recipe-host recipe-sec"></div>
              <div class="row-end" style="margin-top:8px">
                <button id="sec-add-rec" class="btn">Agregar receta SEC</button>
              </div>
            </section>

            <section class="med-sub" id="med-extra" data-visible="entrevista">
              <h4 class="med-subtitle">Extrasistema</h4>
              <div id="extra-box" class="recipe"></div>
            </section>

            <section class="med-sub" id="med-automed" data-visible="entrevista">
              <h4 class="med-subtitle">Automedicaci√≥n</h4>
              <div id="auto-box" class="recipe">
                <div class="row" style="gap:10px;flex-wrap:wrap">
                  <input id="auto-line" placeholder="Ej: IBUPROFENO 400 MG SOS" style="flex:1"/>
                  <button id="auto-add" class="btn">Agregar medicamentos</button>
                </div>
                <ul id="auto-list" class="list" style="margin-top:8px"></ul>
              </div>
            </section>

            <section class="med-sub" id="med-plantas" data-visible="entrevista">
              <h4 class="med-subtitle">Plantas medicinales</h4>
              <div id="pl-box" class="recipe">
                <div class="row" style="gap:10px;flex-wrap:wrap">
                  <select id="pl-sel" style="min-width:220px"></select>
                  <button id="pl-add" class="btn">Agregar planta</button>
                </div>
                <ul id="pl-list" class="list" style="margin-top:8px"></ul>
              </div>
            </section>
          </div>

          <!-- ======= CONCILIACI√ìN ======= -->
          <h3 style="margin-top:16px">2Ô∏è‚É£ Conciliaci√≥n</h3>
          <ul id="conciliacion-list" class="list"></ul>
          <div class="row-end" style="margin-top:8px">
            <button id="btn-conciliar" class="btn">Marcar conciliaci√≥n</button>
          </div>

          <!-- ======= ERRORES ======= -->
          <h3 style="margin-top:16px">3Ô∏è‚É£ Error de medicaci√≥n</h3>
          <div class="row" style="gap:10px;flex-wrap:wrap">
            <select id="err-etapa">
              <option value="">Etapa‚Ä¶</option>
              <option>Prescripci√≥n</option>
              <option>Transcripci√≥n</option>
              <option>Dispensaci√≥n</option>
              <option>Administraci√≥n</option>
              <option>Monitorizaci√≥n</option>
            </select>
              <input id="err-desc" placeholder="Descripci√≥n breve" style="flex:1"/>
            <button id="err-add" class="btn">Agregar</button>
          </div>
          <ul id="errores-list" class="list" style="margin-top:8px"></ul>
        </div>

        <div id="panel-ea" data-panel class="card">
          <div class="seg-title">Reacciones adversas (RAM)</div>
          <div id="ea-out" class="row"></div>
        </div>

        <div id="panel-prm" data-panel class="card">
          <div class="seg-title">PRM</div>
          <div id="prm-auto"></div>
          <div class="muted">Se completa autom√°ticamente desde Medicaci√≥n, Conciliaci√≥n y RAM.</div>
        </div>

        <div id="panel-edu" data-panel class="card">
          <div class="seg-title">EDUCACI√ìN</div>
          <div id="edu-out" class="muted">‚Äî Sin contenidos a√∫n ‚Äî</div>
        </div>

        <div id="panel-herr" data-panel class="card">
          <div class="seg-title">HERRAMIENTAS (Tests + Calculadoras)</div>
          <div id="herr-out" class="muted">‚Äî Sin resultados a√∫n ‚Äî</div>
        </div>

        <div id="panel-indi" data-panel class="card">
          <div class="seg-title">INDICACIONES</div>
          <div id="ind-out" class="muted">‚Äî Sin contenidos a√∫n ‚Äî</div>
        </div>

        <div id="panel-acu" data-panel class="card">
          <div class="seg-title">ACUERDOS</div>
          <div id="acu-out" class="muted">‚Äî Sin contenidos a√∫n ‚Äî</div>
        </div>

      </section>

      <!-- ===== LATERAL DERECHO: Fichas activas ===== -->
      <aside class="fichas-panel">
        <h3 style="margin-bottom:8px;">Fichas</h3>
        <div id="lista-fichas" class="fichas-lista muted">‚Äî sin fichas abiertas ‚Äî</div>
      </aside>
    </div>
  </main>
</div>

<!-- ======= MODAL IMPORTACI√ìN RAYEN ======= -->
<div id="import-rayen-modal" class="modal">
  <div class="modal-card">
    <h3>Importar receta desde Rayen</h3>
    <p class="muted" style="margin-top:4px">Pega el detalle de la ficha y la aplicaci√≥n intentar√° asignar los SKUs oficiales.</p>
    <textarea id="rayen-input" rows="12" style="width:100%;margin-top:12px;background:#0b1120;color:#e2e8f0;border:1px solid rgba(148,163,184,.35);border-radius:12px;padding:10px" placeholder="Pega aqu√≠ el texto copiado desde Rayen‚Ä¶"></textarea>
    <div class="row-end" style="margin-top:12px">
      <button id="rayen-cancel" class="btn mini" style="border-color:#ef4444;color:#ef4444;background:transparent">Cancelar</button>
      <button id="rayen-process" class="btn">Procesar</button>
    </div>
  </div>
</div>

<!-- ====== SCRIPTS ====== -->
<script type="module" src="../js/atencion-page.js"></script>
</body>
</html>